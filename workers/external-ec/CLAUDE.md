# workers/external-ec/CLAUDE.md

## ğŸ¯ ç›®çš„ãƒ»å½¹å‰²

å¤–éƒ¨ECãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ï¼ˆãŠã¡ã‚ƒã®ã“ãƒãƒƒãƒˆï¼‰ã¨ã®é€£æºå‡¦ç†ã‚’æ‹…å½“ã™ã‚‹ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ã€‚å•†å“æƒ…å ±ãƒ»åœ¨åº«ãƒ»ä¾¡æ ¼ã®åŒæœŸã‚’è‡ªå‹•åŒ–ã€‚

## ğŸ—ï¸ æŠ€è¡“æ§‹æˆ
- **ã‚¤ãƒ³ãƒ•ãƒ©**: AWS Copilot (ECS)
- **ã‚³ãƒ³ãƒ†ãƒŠ**: Docker + Node.js 23.9.0
- **ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: AWS SQS + ECS ã‚¿ã‚¹ã‚¯
- **ä¾å­˜é–¢ä¿‚**: backend-core, common, å¤–éƒ¨EC API

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
```
workers/external-ec/
â”œâ”€â”€ package.json              # ä¾å­˜é–¢ä¿‚å®šç¾©
â”œâ”€â”€ tsconfig.json             # TypeScriptè¨­å®š
â””â”€â”€ src/
    â”œâ”€â”€ index.ts              # ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
    â””â”€â”€ controllers/
        â”œâ”€â”€ ochanokoOrder/
        â”‚   â””â”€â”€ main.ts       # ãŠã¡ã‚ƒã®ã“æ³¨æ–‡å‡¦ç†
        â”œâ”€â”€ ochanokoUpdatePrice/
        â”‚   â””â”€â”€ main.ts       # ä¾¡æ ¼åŒæœŸå‡¦ç†
        â””â”€â”€ ochanokoUpdateStockNumber/
            â””â”€â”€ main.ts       # åœ¨åº«åŒæœŸå‡¦ç†
```

## â˜ï¸ AWS ãƒªã‚½ãƒ¼ã‚¹
- **ã‚µãƒ¼ãƒ“ã‚¹**: ECS Fargate
- **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**: ç’°å¢ƒä¾å­˜
- **ç’°å¢ƒè¨­å®š**: ãŠã¡ã‚ƒã®ã“ API èªè¨¼æƒ…å ±ç®¡ç†

## ğŸ”„ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ
- **ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥**: Blue-Green (Copilot managed)
- **ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**: GitHub Actions â†’ AWS Copilot
- **ç’°å¢ƒåˆ‡ã‚Šæ›¿ãˆ**: è‡ªå‹• (copilot/worker-external-ec/)

## ğŸ”§ ä¸»è¦æ©Ÿèƒ½
- **æ³¨æ–‡åŒæœŸ**: ãŠã¡ã‚ƒã®ã“ãƒãƒƒãƒˆã‹ã‚‰ã®æ³¨æ–‡å–è¾¼
- **ä¾¡æ ¼åŒæœŸ**: POSâ†’å¤–éƒ¨ECã®ä¾¡æ ¼æ›´æ–°
- **åœ¨åº«åŒæœŸ**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åœ¨åº«æ•°åŒæœŸ
- **å•†å“ãƒã‚¹ã‚¿åŒæœŸ**: å•†å“æƒ…å ±ã®åŒæ–¹å‘åŒæœŸ

## ğŸ’¡ é‹ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³
- å®šæœŸçš„ãªãƒãƒ¼ãƒªãƒ³ã‚° + Webhookå—ä¿¡
- ãƒãƒƒãƒå‡¦ç†ã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†ã®ä½µç”¨
- å·®åˆ†æ¤œå‡ºã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªåŒæœŸ

## ğŸ“Š ç›£è¦–ãƒ»ãƒ­ã‚°
- **ç›£è¦–é …ç›®**: APIå¿œç­”æ™‚é–“ã€åŒæœŸæˆåŠŸç‡ã€å·®åˆ†æ¤œå‡ºæ•°
- **ãƒ­ã‚°å‡ºåŠ›**: CloudWatch Logsã€å¤–éƒ¨APIé€šä¿¡ãƒ­ã‚°
- **ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š**: APIéšœå®³ã€åŒæœŸå¤±æ•—ç‡ > 10%

## ğŸ”— é–¢é€£ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
- [workers/](../) - ãƒ¯ãƒ¼ã‚«ãƒ¼å…¨ä½“çµ±æ‹¬
- [packages/backend-core/src/services/external/ochanoko/](../../packages/backend-core/src/services/external/ochanoko/) - ãŠã¡ã‚ƒã®ã“é€£æºãƒ­ã‚¸ãƒƒã‚¯
- [copilot/worker-external-ec/](../../copilot/worker-external-ec/) - ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š

## ğŸ“ é‹ç”¨ãƒ¡ãƒ¢
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: APIåˆ¶é™å¯¾å¿œã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™éµå®ˆ
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: APIèªè¨¼ã‚­ãƒ¼ã®å®‰å…¨ç®¡ç†ã€HTTPSé€šä¿¡å¿…é ˆ
- **ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: å¤–éƒ¨APIéšœå®³æ™‚ã®å†è©¦è¡Œæˆ¦ç•¥ã€æ‰‹å‹•åŒæœŸæ©Ÿèƒ½

---
*Infrastructure-Agentä½œæˆ: 2025-01-24*