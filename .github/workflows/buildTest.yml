name: Run Build and Lint Test
# developブランチに対してPRが作成されたタイミングをトリガーとする
on:
  pull_request:
    branches:
      - develop
      - staging
      - production
jobs:
  build-and-lint:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '23'

      - name: install dependencies
        run: |
          sudo apt-get update -y
          sudo apt-get install -y openssl build-essential libcairo2-dev libpango1.0-dev libjpeg-dev libgif-dev librsvg2-dev g++

      - name: install pnpm
        run: npm i -g pnpm
      - name: install dependencies
        run: pnpm i --frozen-lockfile
      - name: prisma-generate
        run: pnpm run prisma:generate
      - name: backend-core
        run: pnpm run build:backend-core
      - name: common
        run: pnpm run build:common
      - name: api-generator
        run: pnpm api:generate && ls -la packages/api-generator/src/generated/client
      - name: web-app lint
        run: pnpm lint:web-app --quiet
      - name: web-app build
        run: cd packages/web-app && pnpm run build
