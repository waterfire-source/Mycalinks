# functions/email-webhook/CLAUDE.md

## ğŸ¯ ç›®çš„ãƒ»å½¹å‰²

ãƒ¡ãƒ¼ãƒ«é…ä¿¡Webhookã‚’å‡¦ç†ã™ã‚‹Lambdaé–¢æ•°ã€‚å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ï¼ˆç‰¹ã«ãŠã¡ã‚ƒã®ã“ãƒãƒƒãƒˆï¼‰ã‹ã‚‰ã®ãƒ¡ãƒ¼ãƒ«é–¢é€£ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ä¿¡ã—ã€ã‚·ã‚¹ãƒ†ãƒ å†…éƒ¨ã§ã®é©åˆ‡ãªå‡¦ç†ã‚’å®Ÿè¡Œã€‚

## ğŸ—ï¸ æŠ€è¡“æ§‹æˆ
- **ã‚¤ãƒ³ãƒ•ãƒ©**: AWS Lambda
- **ã‚³ãƒ³ãƒ†ãƒŠ**: Node.js 23.9.0
- **ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: API Gateway + Lambda
- **ä¾å­˜é–¢ä¿‚**: backend-core, AWS SES, ãŠã¡ã‚ƒã®ã“API

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
```
functions/email-webhook/
â”œâ”€â”€ app.ts                    # Lambdaé–¢æ•°ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ package.json              # ä¾å­˜é–¢ä¿‚å®šç¾©
â”œâ”€â”€ samconfig.toml            # SAMè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ template.yml              # CloudFormationãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”œâ”€â”€ tsconfig.json             # TypeScriptè¨­å®š
â””â”€â”€ services/                 # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
    â”œâ”€â”€ main.ts               # ãƒ¡ã‚¤ãƒ³å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯
    â””â”€â”€ ochanoko.ts           # ãŠã¡ã‚ƒã®ã“ãƒãƒƒãƒˆå°‚ç”¨å‡¦ç†
```

## â˜ï¸ AWS ãƒªã‚½ãƒ¼ã‚¹
- **ã‚µãƒ¼ãƒ“ã‚¹**: Lambda, API Gateway
- **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**: ç’°å¢ƒä¾å­˜
- **ç’°å¢ƒè¨­å®š**: Webhook ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€ç’°å¢ƒå¤‰æ•°

## ğŸ”„ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ
- **ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥**: AWS SAM Deploy
- **ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**: GitHub Actions â†’ SAM Build â†’ Deploy
- **ç’°å¢ƒåˆ‡ã‚Šæ›¿ãˆ**: sam deploy --config-env [staging|production]

## ğŸ”§ ä¸»è¦æ©Ÿèƒ½
- **Webhookå—ä¿¡**: ãŠã¡ã‚ƒã®ã“ãƒãƒƒãƒˆã‹ã‚‰ã®ãƒ¡ãƒ¼ãƒ«é…ä¿¡çŠ¶æ³é€šçŸ¥
- **ãƒã‚¦ãƒ³ã‚¹å‡¦ç†**: é…ä¿¡å¤±æ•—ãƒ¡ãƒ¼ãƒ«ã®è‡ªå‹•å‡¦ç†
- **é…ä¿¡çŠ¶æ³æ›´æ–°**: ãƒ¡ãƒ¼ãƒ«é…ä¿¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®DBæ›´æ–°
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ä¸æ­£ãªWebhookã®æ¤œè¨¼ãƒ»æ‹’å¦

## ğŸ’¡ é‹ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³
- API GatewayçµŒç”±ã®HTTPSå—ä¿¡
- ç½²åæ¤œè¨¼ã«ã‚ˆã‚‹æ­£å½“æ€§ç¢ºèª
- éåŒæœŸã§ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚­ãƒ¥ãƒ¼ã¸ã®é…ä¿¡

## ğŸ“Š ç›£è¦–ãƒ»ãƒ­ã‚°
- **ç›£è¦–é …ç›®**: å®Ÿè¡Œå›æ•°ã€ã‚¨ãƒ©ãƒ¼ç‡ã€å¿œç­”æ™‚é–“
- **ãƒ­ã‚°å‡ºåŠ›**: CloudWatch Logsã€Webhookå—ä¿¡ãƒ­ã‚°
- **ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š**: ã‚¨ãƒ©ãƒ¼ç‡ > 10%ã€å¿œç­”æ™‚é–“ > 10ç§’

## ğŸ”— é–¢é€£ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
- [functions/](../) - Lambdaé–¢æ•°çµ±æ‹¬
- [workers/notification/](../../workers/notification/) - é€šçŸ¥å‡¦ç†ãƒ¯ãƒ¼ã‚«ãƒ¼
- [packages/backend-core/src/services/external/ochanoko/](../../packages/backend-core/src/services/external/ochanoko/) - ãŠã¡ã‚ƒã®ã“é€£æº

## ğŸ“ é‹ç”¨ãƒ¡ãƒ¢
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆå¯¾ç­–ã€ãƒ¡ãƒ¢ãƒª128MBæœ€é©åŒ–
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: Webhookç½²åæ¤œè¨¼ã€HTTPSå¿…é ˆã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™
- **ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: ä¸æ­£ãƒªã‚¯ã‚¨ã‚¹ãƒˆåˆ†æã€é…ä¿¡å¤±æ•—èª¿æŸ»

---
*Infrastructure-Agentä½œæˆ: 2025-01-24*