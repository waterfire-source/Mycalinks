# TypeScriptエラー分析レポート

## エラー概要

対象プロジェクト：packages/web-app  
検出されたエラー総数：981件

本レポートでは、現在発生しているTypeScriptエラーの分析結果と修正方針について記載する。

## エラー種別の分布

分析の結果、以下のエラーが頻出していることが判明した。

| エラーコード | 件数 | 割合  | エラー内容                   |
| ------------ | ---- | ----- | ---------------------------- |
| TS18048      | 396  | 40.4% | Possibly 'undefined' エラー  |
| TS2322       | 173  | 17.6% | 型不適合エラー               |
| TS2339       | 116  | 11.8% | プロパティ不存在エラー       |
| TS2345       | 85   | 8.7%  | 引数型不適合エラー           |
| TS2537       | 30   | 3.1%  | 型推論失敗エラー             |
| TS7006       | 28   | 2.9%  | implicitly 'any' エラー      |
| TS2551       | 24   | 2.4%  | プロパティ存在チェックエラー |
| TS2741       | 14   | 1.4%  | 必須プロパティ不足エラー     |
| TS2304       | 14   | 1.4%  | 名前が見つからないエラー     |
| TS2532       | 13   | 1.3%  | 'undefined' 不適合エラー     |

最も多いのはTS18048（Possibly 'undefined'）で、全体の4割を占めている。これは厳格なnullチェック設定による検出が主な要因と考えられる。

## 根本原因の分析

### 1. データベーススキーマの大規模リファクタリング

Prismaスキーマが大幅に変更されたことにより、フロントエンド側の型定義が追従できていない状況が発生している。

**具体的な問題**

- モデル名の変更・削除（Condition_Option → Item_Category_Condition_Option等）
- プロパティの削除（Account.kind、Transaction.register_account_id等）
- エクスポートされていない型への参照

### 2. API定義ファイルの不整合・欠損

スキーマ変更に伴いAPI定義ファイルが削除・移動されたが、インポート元が更新されていないケースが多数確認された。

**主要な問題パターン**

```typescript
// 存在しないファイルのインポート
import {...} from '@/app/api/store/[store_id]/appraisal/def';

// エクスポートされていない型の参照
import { ItemCsvUploadOptions, ProductCsvUploadOptions } from '@/constants/mycapos';
```

### 3. null/undefined安全性の問題

厳格なnullチェック設定により、これまで潜在的に存在していた安全性の問題が顕在化している。

## 修正方針と優先度

### 高優先度：基盤修正（即座対応）

**Prisma型エラー**

- TS2724：4件 - 存在しないPrismaメンバー
- TS2305：3件 - エクスポートされていないメンバー

### API型定義の修正

**対象エラー**

- TS2339：116件 - プロパティ不存在エラー
- TS2345：85件 - 引数型不適合エラー
- TS2741：14件 - 必須プロパティ不足エラー

**修正内容**

- データベーススキーマ変更による型定義の更新
- API レスポンス型と実際のレスポンスの同期
- 削除されたプロパティへの参照の修正

### 安全性とコード品質の向上

**null/undefined安全性の強化**

- TS18048：396件への対応
- Optional チェーン（?.）の導入
- 型ガードの実装

**その他の品質向上**

- モジュール解決の修正
- 型推論の改善
- any型の排除(tsconfgのstrict:trueの影響)

## 影響度の高いファイル

以下のファイルで特に多くのエラーが発生している：

- `/src/api/frontend/store/api.ts`（58+エラー）
- `/src/api/frontend/appraisal/api.ts`（査定関連の複数エラー）

これらのファイルはPOS中核機能に関連しており、優先的な対応が必要である。

**まとめ**
全機能に及んでいるが、特にPOS中核機能への影響が大きい。データベーススキーマ変更に伴う型定義の更新遅れが主な原因となっている。

段階的修正しないとデグレの可能性があるため気をつけた方が良いと思われる。
