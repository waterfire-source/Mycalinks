# Purchase Reception Feature

## 概要
買取受付機能。顧客からの買取申込受付、査定前商品の管理、本人確認、査定待ちキュー管理など、買取プロセスの初期段階を管理する。

## 主要機能

### 買取受付管理
- 買取申込受付
- 受付番号発行
- 顧客情報登録
- 商品リスト作成

### 本人確認
- 身分証明書確認
- 未成年者対応
- 保護者同意取得
- デジタル署名

### 査定前管理
- 未査定商品リスト
- 査定済み商品リスト
- ステータス管理
- 優先度設定

### QRコード発行
- 受付番号QRコード
- 顧客用控え発行
- モバイル連携
- 進捗確認

## ディレクトリ構造

```
purchaseReception/
├── components/          # UIコンポーネント
│   ├── buttons/        # アクションボタン
│   ├── cards/          # カード型UI
│   ├── modals/         # モーダルダイアログ
│   │   └── modalComponents/  # モーダル用部品
│   ├── purchaseTerm/   # 買取規約
│   ├── select/         # 選択UI
│   └── tables/         # テーブル表示
└── hooks/              # カスタムフック
```

## 主要コンポーネント

### 買取受付
#### NewPurchaseModal
- 新規買取受付登録
- 顧客情報入力
- 商品概要登録
- 受付番号発行

#### PurchaseNumberModal
- 受付番号表示
- QRコード生成
- 控え印刷
- SMS/メール送信

### 本人確認
#### IdentityVerificationForm
- 身分証明書登録
- OCR読取対応
- 画像アップロード
- 情報照合

#### MinorField
- 未成年者判定
- 保護者情報入力
- 同意書アップロード
- 電子署名取得

### 査定管理
#### UnappreciatedTable
- 未査定商品一覧
- 優先度ソート
- フィルタリング
- 一括操作

#### AppraisedTable
- 査定済み商品一覧
- 査定結果表示
- 承認待ち管理
- 履歴追跡

### ステータス管理
#### TabStatusFilterTable
- ステータス別表示
- 進捗管理
- 期限アラート
- 担当者割当

## データモデル

### TransactionCart
```typescript
interface TransactionCart {
  id: number;
  reception_number: string;        // 受付番号
  customer_id: number;             // 顧客ID
  staff_account_id: number;        // 受付スタッフID
  register_account_id: number;     // レジ担当者ID
  discount_price: number;          // 割引額
  transaction_cart_items: TransactionCartItem[];
}
```

### TransactionCartItem
```typescript
interface TransactionCartItem {
  cart_item_id: string;
  item_count: number;
  unit_price: number;
  discount_price: number;
  product_details: {
    id: number;
    display_name: string;
    // ... 商品詳細
  };
}
```

## 買取受付フロー

### 1. 受付開始
- 顧客来店
- 買取希望申出
- 受付番号発行
- 仮登録作成

### 2. 本人確認
- 身分証提示
- 情報入力・照合
- 年齢確認
- 必要書類取得

### 3. 商品登録
- 商品リスト作成
- 概要情報入力
- 写真撮影（オプション）
- 数量確認

### 4. 規約確認
- 買取規約表示
- 同意取得
- 署名（電子/手書き）
- 控え発行

### 5. 査定待ち
- 査定キュー登録
- 優先度設定
- 担当者アサイン
- 進捗通知

## 状態管理

### LocalStorage活用
- 受付中データの一時保存
- 入力途中の復元
- オフライン対応
- データ同期

### ステータス遷移
```
受付前 → 受付中 → 本人確認済 → 査定待ち → 査定中 → 査定完了
  ↓         ↓         ↓           ↓         ↓
キャンセル  中断      却下        保留      買取成立
```

## コンプライアンス

### 古物営業法対応
- 本人確認必須
- 18歳未満の制限
- 取引記録保存（3年）
- 不正品チェック

### 個人情報保護
- 身分証画像の暗号化
- アクセス権限制御
- 保存期間管理
- 削除処理

### 未成年者対応
- 年齢自動判定
- 保護者同意必須
- 同意書テンプレート
- 確認記録保存

## QRコード機能

### 受付番号QR
- ユニークID埋め込み
- 有効期限設定
- 偽造防止対策
- スキャン履歴

### 活用シーン
- 進捗確認
- 査定結果照会
- 支払い処理
- 顧客側アプリ連携

## バリデーション

### 本人確認
- 身分証有効期限
- 住所・氏名照合
- 年齢計算
- 重複チェック

### 商品情報
- 必須項目チェック
- 数量妥当性
- カテゴリ整合性
- 禁止品チェック

## エラーハンドリング

### 入力エラー
- リアルタイムバリデーション
- エラーメッセージ表示
- 修正ガイド
- 自動補完

### システムエラー
- 受付データ保護
- 自動リカバリ
- 管理者通知
- 代替フロー

## パフォーマンス

### 高速化対応
- 画像圧縮
- 遅延ローディング
- キャッシュ活用
- バッチ処理

### 大量受付対応
- キュー管理
- 負荷分散
- 非同期処理
- 進捗表示

## セキュリティ

### データ保護
- 通信暗号化
- ストレージ暗号化
- アクセスログ
- 改ざん検知

### 不正防止
- 本人確認徹底
- 盗品データベース照合
- 異常パターン検知
- ブラックリスト

## 今後の拡張予定

1. **AI査定連携**
   - 商品自動識別
   - 価格予測
   - 状態評価
   - 優先度自動設定

2. **オンライン受付**
   - Web事前申込
   - 画像アップロード
   - 仮査定機能
   - 来店予約

3. **モバイル対応**
   - 顧客アプリ連携
   - プッシュ通知
   - 査定進捗確認
   - 電子サイン

## 関連機能

- [買取管理](/purchase/CLAUDE.md)
- [査定機能](/appraisal/CLAUDE.md)
- [顧客管理](/customers/CLAUDE.md)
- [在庫管理](/stock/CLAUDE.md)