# 買取（Purchase）モジュール

## 概要
商品の買取処理を管理するモジュール。査定、価格決定、買取契約、在庫登録までの一連の買取フローを実装。

## ディレクトリ構成
```
purchase/
├── components/
│   └── DesktopPurchasePage.tsx    # デスクトップ版買取画面
└── page.tsx                       # メインページコンポーネント
```

## 主要機能

### 1. 買取査定
- **商品検索**: JANコード、商品名での検索
- **相場確認**: 買取相場データベース参照
- **状態評価**: コンディション選択（新品、中古A〜D等）
- **査定金額算出**: 基準価格×状態係数

### 2. 買取処理
- **顧客情報登録**: 本人確認、連絡先入力
- **商品登録**: 査定済み商品の一括登録
- **買取金額確定**: 合計金額の計算・確認
- **支払処理**: 現金・振込選択

### 3. 在庫登録
- **商品情報入力**: 
  - 基本情報（商品名、JAN、型番）
  - 販売価格設定
  - 商品画像撮影
- **在庫番号発行**: 自動採番
- **ラベル印刷**: 値札・管理ラベル出力

### 4. 買取契約管理
- **契約書作成**: 法定書式に準拠
- **身分証明書記録**: 画像保存
- **契約履歴**: 過去の買取履歴参照

## 技術仕様

### コンポーネント構成
```typescript
// メインページ
<ThemeProvider theme={specialTheme}>
  <PurchaseCartProvider>
    <DesktopPurchasePage />
  </PurchaseCartProvider>
</ThemeProvider>
```

### Context/State管理
- **PurchaseCartContext**: 買取カート状態管理
  - 査定商品リスト
  - 買取金額計算
  - 顧客情報
  - 支払情報

### API連携
- `/api/purchase/appraisal`: 査定情報取得
- `/api/purchase/create`: 買取取引作成
- `/api/product/register`: 商品在庫登録
- `/api/customer/purchase-history`: 買取履歴

## UI/UX設計

### デスクトップ版レイアウト
```
┌─────────────────────────────────────────────┐
│ ヘッダー（買取査定）                         │
├───────────────┬─────────────────────────────┤
│               │ 査定商品リスト               │
│ 顧客情報      │ ├─商品1 [状態] [査定額]    │
│               │ ├─商品2 [状態] [査定額]    │
│ 商品検索      │ └─商品3 [状態] [査定額]    │
│               ├─────────────────────────────┤
│ 査定相場      │ 査定合計: ¥50,000          │
│               │ 手数料: ¥0                  │
│               │ 買取金額: ¥50,000          │
│               ├─────────────────────────────┤
│               │ [買取確定]                   │
└───────────────┴─────────────────────────────┘
```

## 買取フロー

### 1. 査定フェーズ
1. 顧客来店・買取希望
2. 商品の状態確認
3. 相場データベース参照
4. 査定金額提示

### 2. 契約フェーズ
1. 顧客情報入力
2. 身分証明書確認・記録
3. 買取契約書作成
4. 署名・同意取得

### 3. 支払フェーズ
1. 買取金額確定
2. 支払方法選択
3. 現金支払/振込手続き
4. 領収書発行

### 4. 在庫化フェーズ
1. 商品詳細情報入力
2. 販売価格設定
3. 商品画像撮影
4. 在庫登録・ラベル印刷

## 法令遵守事項
- **古物営業法対応**:
  - 本人確認の徹底
  - 取引記録の保管（3年間）
  - 盗品等の確認
- **個人情報保護**:
  - 顧客情報の適切な管理
  - 身分証明書の安全な保管

## セキュリティ考慮事項
- 顧客個人情報の暗号化
- 身分証明書画像の安全な保存
- アクセス権限管理
- 操作ログの記録

## パフォーマンス最適化
- 相場データのキャッシュ
- 画像アップロードの最適化
- 大量商品登録時のバッチ処理

## エラーハンドリング
- 相場データ取得失敗時の対応
- 在庫登録エラーのロールバック
- ネットワークエラー時の一時保存

## 関連モジュール
- `/purchaseReception`: 買取受付
- `/purchaseTable`: 買取表管理
- `/stock`: 在庫管理
- `/appraisal`: 査定マスタ