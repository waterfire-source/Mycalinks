# 買取表（Purchase Table）モジュール

## 概要
買取価格表の作成・管理を行うモジュール。商品ジャンル別の買取価格一覧表を作成し、印刷・配布用の買取表を生成する機能を実装。

## ディレクトリ構成
```
purchaseTable/
├── components/
│   ├── CreatePurchaseTableModal/           # 買取表作成モーダル
│   │   ├── CreatePurchaseTableModal.tsx    # メインモーダル
│   │   ├── CreatePurchaseTableModalContent.tsx # モーダル内容
│   │   ├── DisplayImageModal/              # 画像表示モーダル
│   │   ├── InputComponent/                 # 入力コンポーネント
│   │   ├── ItemComponent/                  # アイテム選択コンポーネント
│   │   ├── ListedProductComponent/         # 商品リストコンポーネント
│   │   └── UpdateItemPriceModal/           # 価格更新モーダル
│   ├── DeletePurchaseTableButton.tsx       # 削除ボタン
│   ├── PurchaseTableList.tsx               # 買取表一覧
│   └── PurchaseTablePageContent.tsx        # ページ内容
└── page.tsx                                # メインページ
```

## 主要機能

### 1. 買取表作成
- **テンプレート選択**: 複数の買取表フォーマット
- **商品アイテム選択**: カテゴリ・ジャンル別商品絞り込み
- **価格設定**: 各商品の買取価格設定
- **デザインカスタマイズ**: 色、レイアウト、画像の設定

### 2. 買取表管理
- **買取表一覧**: 作成済み買取表の管理
- **編集・更新**: 既存買取表の修正
- **複製機能**: 既存買取表からの新規作成
- **削除機能**: 不要な買取表の削除

### 3. 価格管理
- **一括価格更新**: 選択商品の価格一括変更
- **価格履歴**: 過去の価格変更履歴
- **相場連動**: 市場価格との連動設定
- **条件別価格**: 状態別の価格設定

### 4. 出力・印刷
- **PDF生成**: 印刷用PDFファイル作成
- **レイアウト調整**: 用紙サイズ・向きの選択
- **ロゴ・店舗情報**: 店舗ブランディング要素追加
- **QRコード**: 店舗URLやお問い合わせ先の追加

## 技術仕様

### 買取表データ構造
```typescript
interface PurchaseTableInfo {
  title: string;                      // 買取表タイトル
  color: string;                      // テーマカラー
  comment?: string;                   // 説明・注意事項
  customTemplateImageUrl?: string;    // カスタム画像URL
  format: string;                     // フォーマット設定
  order: string;                      // 商品表示順序
  showStoreName: boolean;             // 店舗名表示設定
  items: {
    itemId: number;                   // 商品ID
    displayPrice: number;             // 表示価格
    anyModelNumber: boolean;          // 型番任意フラグ
  }[];
}
```

### API連携
- `/api/purchase-table/list`: 買取表一覧取得
- `/api/purchase-table/create`: 新規買取表作成
- `/api/purchase-table/update`: 買取表更新
- `/api/purchase-table/delete`: 買取表削除
- `/api/purchase-table/export`: PDF出力

## UI/UX設計

### メイン画面レイアウト
```
┌─────────────────────────────────────────────┐
│ 買取表一覧                    [新規買取表作成] │
├─────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────┐ │
│ │ ゲーム機本体買取表                       │ │
│ │ 作成日: 2025-06-13                      │ │
│ │ 商品数: 15件                            │ │
│ │ [編集] [複製] [PDF出力] [削除]           │ │
│ └─────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────┐ │
│ │ トレーディングカード買取表               │ │
│ │ 作成日: 2025-06-12                      │ │
│ │ 商品数: 50件                            │ │
│ │ [編集] [複製] [PDF出力] [削除]           │ │
│ └─────────────────────────────────────────┘ │
└─────────────────────────────────────────────┘
```

### 買取表作成モーダル
```
┌─────────────────────────────────────────────┐
│ 新規買取表作成                         [×]  │
├─────────────────────────────────────────────┤
│ 基本設定                                     │
│ ┌─────────────────────────────────────────┐ │
│ │ 買取表タイトル: [________________]      │ │
│ │ テーマカラー: [●赤] [●青] [●緑]       │ │
│ │ 説明・注意事項: [________________]      │ │
│ └─────────────────────────────────────────┘ │
│ 商品選択                                     │
│ ┌─────────────────────────────────────────┐ │
│ │ カテゴリ: [ゲーム ▼]                   │ │
│ │ ジャンル: [本体 ▼]                     │ │
│ │ ┌─────────────────────────────────────┐ │ │
│ │ │ ☑ Nintendo Switch    ¥25,000      │ │ │
│ │ │ ☑ PlayStation 5      ¥35,000      │ │ │
│ │ │ ☐ Xbox Series X       ¥30,000      │ │ │
│ │ └─────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────┘ │
│                              [作成] [キャンセル] │
└─────────────────────────────────────────────┘
```

## 買取表作成フロー

### 1. 基本設定
1. 買取表タイトル入力
2. テーマカラー選択
3. レイアウト形式選択
4. 説明・注意事項入力

### 2. 商品選択
1. カテゴリ・ジャンル絞り込み
2. 対象商品のチェック選択
3. 商品別価格設定
4. 表示順序の調整

### 3. デザイン調整
1. カスタム画像アップロード
2. 店舗ロゴの配置
3. QRコード追加
4. プレビュー確認

### 4. 保存・出力
1. 買取表データ保存
2. PDF生成・ダウンロード
3. 印刷設定・実行
4. 配布・掲示

## テンプレート機能
- **標準テンプレート**: 汎用的な買取表レイアウト
- **カテゴリ別テンプレート**: 商品ジャンル特化レイアウト
- **カスタムテンプレート**: 独自デザインの作成
- **季節限定テンプレート**: イベント・キャンペーン用

## 価格管理機能
- **基準価格設定**: 商品マスタとの連動
- **変動率設定**: 相場変動の自動反映
- **期間限定価格**: キャンペーン価格の設定
- **条件別価格**: 状態・数量による価格差

## 出力オプション
- **PDF出力**: 高品質印刷用PDF生成
- **画像出力**: SNS・Web用画像生成
- **CSV出力**: 価格データのエクスポート
- **印刷設定**: 用紙サイズ・カラー設定

## セキュリティ考慮事項
- 買取価格情報の保護
- 編集権限の管理
- 操作ログの記録
- データバックアップ

## パフォーマンス最適化
- 商品データのキャッシュ
- 画像の最適化・圧縮
- PDF生成の非同期処理
- 大量商品選択時の処理最適化

## エラーハンドリング
- PDF生成失敗時の対応
- 画像アップロードエラー
- 保存失敗時の復旧
- 削除操作の確認

## 関連モジュール
- `/purchase`: 買取処理
- `/purchaseReception`: 買取受付
- `/item`: 商品マスタ
- `/appraisal`: 査定価格
- `/store`: 店舗設定