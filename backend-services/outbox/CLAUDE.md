# backend-services/outbox/CLAUDE.md

## ğŸ¯ ç›®çš„ãƒ»å½¹å‰²

ã‚¢ã‚¦ãƒˆãƒœãƒƒã‚¯ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè£…ã™ã‚‹ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¨ã‚¤ãƒ™ãƒ³ãƒˆé…ä¿¡ã®ä¸€è²«æ€§ã‚’ä¿è¨¼ã—ã€ã‚·ã‚¹ãƒ†ãƒ é–“ã®ä¿¡é ¼æ€§ã®é«˜ã„é€£æºã‚’å®Ÿç¾ã€‚

## ğŸ—ï¸ æŠ€è¡“æ§‹æˆ
- **ã‚¤ãƒ³ãƒ•ãƒ©**: AWS Copilot (ECS)
- **ã‚³ãƒ³ãƒ†ãƒŠ**: Docker + Node.js 23.9.0
- **ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: SQS + SNS + ã‚¤ãƒ™ãƒ³ãƒˆãƒ–ãƒªãƒƒã‚¸
- **ä¾å­˜é–¢ä¿‚**: backend-core, Prisma ORM, AWS SDK

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
```
backend-services/outbox/
â”œâ”€â”€ README.md                 # ã‚¢ã‚¦ãƒˆãƒœãƒƒã‚¯ã‚¹æ¦‚è¦
â”œâ”€â”€ package.json              # ä¾å­˜é–¢ä¿‚å®šç¾©
â”œâ”€â”€ tsconfig.json             # TypeScriptè¨­å®š
â””â”€â”€ src/
    â”œâ”€â”€ index.ts              # ã‚¢ã‚¦ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ã‚¤ãƒ³
    â””â”€â”€ publishers/           # ã‚¤ãƒ™ãƒ³ãƒˆé…ä¿¡ãƒ­ã‚¸ãƒƒã‚¯
        â”œâ”€â”€ productStockHistory/
        â”‚   â””â”€â”€ main.ts       # åœ¨åº«å±¥æ­´ã‚¤ãƒ™ãƒ³ãƒˆé…ä¿¡
        â””â”€â”€ productUpdate/
            â””â”€â”€ main.ts       # å•†å“æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆé…ä¿¡
```

## â˜ï¸ AWS ãƒªã‚½ãƒ¼ã‚¹
- **ã‚µãƒ¼ãƒ“ã‚¹**: ECS Fargate, SQS, SNS, EventBridge
- **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**: ç’°å¢ƒä¾å­˜
- **ç’°å¢ƒè¨­å®š**: ã‚¢ã‚¦ãƒˆãƒœãƒƒã‚¯ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã€é…ä¿¡ã‚­ãƒ¥ãƒ¼è¨­å®š

## ğŸ”„ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ
- **ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥**: Blue-Green (Copilot managed)
- **ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**: GitHub Actions â†’ AWS Copilot
- **ç’°å¢ƒåˆ‡ã‚Šæ›¿ãˆ**: è‡ªå‹• (copilot/backend-outbox/)

## ğŸ”§ ä¸»è¦æ©Ÿèƒ½
- **åœ¨åº«å±¥æ­´é…ä¿¡**: åœ¨åº«å¤‰å‹•ã‚¤ãƒ™ãƒ³ãƒˆã®ä¿¡é ¼æ€§é…ä¿¡
- **å•†å“æ›´æ–°é…ä¿¡**: å•†å“ãƒã‚¹ã‚¿å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆã®é…ä¿¡
- **ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ä¿è¨¼**: DBãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¨ã‚¤ãƒ™ãƒ³ãƒˆé…ä¿¡ã®ä¸€è²«æ€§
- **é…ä¿¡å¤±æ•—å‡¦ç†**: å†é€ãƒ»Dead Letter Queueãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ

## ğŸ’¡ é‹ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³
- ã‚¢ã‚¦ãƒˆãƒœãƒƒã‚¯ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ« â†’ ãƒãƒ¼ãƒªãƒ³ã‚° â†’ ã‚¤ãƒ™ãƒ³ãƒˆé…ä¿¡
- å†ªç­‰æ€§ä¿è¨¼ï¼ˆé‡è¤‡é…ä¿¡å¯¾å¿œï¼‰
- é †åºä¿è¨¼ï¼ˆãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³å˜ä½ï¼‰

## ğŸ“Š ç›£è¦–ãƒ»ãƒ­ã‚°
- **ç›£è¦–é …ç›®**: é…ä¿¡é…å»¶ã€å¤±æ•—ç‡ã€ã‚¢ã‚¦ãƒˆãƒœãƒƒã‚¯ã‚¹æ»ç•™æ•°
- **ãƒ­ã‚°å‡ºåŠ›**: CloudWatch Logsã€é…ä¿¡æˆåŠŸ/å¤±æ•—ãƒ­ã‚°
- **ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š**: é…ä¿¡é…å»¶ > 10åˆ†ã€å¤±æ•—ç‡ > 3%

## ğŸ”— é–¢é€£ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
- [backend-services/](../) - ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹çµ±æ‹¬
- [packages/backend-core/src/event/](../../packages/backend-core/src/event/) - ã‚¤ãƒ™ãƒ³ãƒˆå®šç¾©
- [copilot/backend-outbox/](../../copilot/backend-outbox/) - ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š

## ğŸ“ é‹ç”¨ãƒ¡ãƒ¢
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ãƒãƒ¼ãƒªãƒ³ã‚°é–“éš”èª¿æ•´ã€ãƒãƒƒãƒã‚µã‚¤ã‚ºæœ€é©åŒ–
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: ã‚¤ãƒ™ãƒ³ãƒˆãƒšã‚¤ãƒ­ãƒ¼ãƒ‰æš—å·åŒ–ã€IAMæœ€å°æ¨©é™
- **ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: ã‚¢ã‚¦ãƒˆãƒœãƒƒã‚¯ã‚¹æ»ç•™æ™‚ã®æ‰‹å‹•å‡¦ç†æ‰‹é †

---
*Infrastructure-Agentä½œæˆ: 2025-01-24*